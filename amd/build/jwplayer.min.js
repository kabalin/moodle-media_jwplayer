/**
 * JW Player module.
 *
 * @module     media_jwplayer/jwplayer
 * @copyright  2017 Ruslan Kabalin, Lancaster University
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("media_jwplayer/jwplayer",["jwplayer","jquery","core/ajax","core/log","module","core/config","core/str"],(function(jwplayer,$,ajax,log,module,config,str){var player={context:null,eventMap:{started:"firstFrame",paused:"pause",seeked:"seek",resumed:"play",completed:"complete"},reqEventMap:{},init:function(playerSetup,playerId,context){if(player.context=context,!$("#"+playerId).length)throw new Error("The target element for player setup (#"+playerId+") is missing.");module.config().licensekey&&(jwplayer.key=module.config().licensekey);let playerInstance=jwplayer(playerId);playerInstance.setup(playerSetup.setupdata),playerSetup.showdownloadbtn&&player.addDownloadButton(playerInstance),playerSetup.events.forEach((function(eventName){if(void 0===player.getEventName(eventName))throw new Error("Event tracking for '"+eventName+"' has no JWPlayer API event mapping.");player.reqEventMap[player.getEventName(eventName)]=eventName,playerInstance.on(player.getEventName(eventName),player.logEvent)})),playerSetup.logerrors&&playerInstance.on("error",player.logError),playerInstance.on("error",(function(event){log.error("media_jwplayer error: "+event.message)})),playerInstance.on("setupError",(function(event){log.error("media_jwplayer setup error: "+event.message)}))},addDownloadButton:function(playerInstance){str.get_string("downloadbuttontitle","media_jwplayer").done((function(tooltip){const iconPath=config.wwwroot+"/media/player/jwplayer/pix/download.svg";playerInstance.addButton(iconPath,tooltip,(function(){window.open(playerInstance.getPlaylistItem().file+"?forcedownload=true")}),"download")})).fail(log.error)},getEventName:function(mdlEventName){return player.eventMap[mdlEventName]},logEvent:function(event){if("play"===event.type&&"interaction"!==event.playReason)return;if("pause"===event.type&&"interaction"!==event.pauseReason)return;let args={context:player.context,event:player.reqEventMap[event.type],title:this.getPlaylistItem().file,position:parseInt(this.getPosition()),medialength:parseInt(this.getDuration())};void 0!==this.getPlaylistItem().title&&(args.title=this.getPlaylistItem().title),"seek"===event.type&&(args.offset=parseInt(event.offset)),$.when(ajax.call([{methodname:"media_jwplayer_playback_event",args:args}])[0]).fail(log.error)},logError:function(event){let args={context:player.context,title:this.getPlaylistItem().file,position:parseInt(this.getPosition()),code:event.code,message:event.message};void 0!==this.getPlaylistItem().title&&(args.title=this.getPlaylistItem().title),$.when(ajax.call([{methodname:"media_jwplayer_playback_failed",args:args}])[0]).fail(log.error)}};return{setupPlayer:player.init}}));

//# sourceMappingURL=jwplayer.min.js.map